<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sinby.demo.dao.CraneTimeCensusDao">

    <!-- 获取到达时间和离开时间 -->
    <select id="getArriveLeaveTime" parameterType="hashmap" resultType="hashmap">
        SELECT WLWZ_X as "wlwzX",WLWZ_Y as "wlwzY",WEIGHT as "weight",TO_CHAR(TM,'yyyy-MM-dd HH24:mi:ss') as "tm"
        FROM WLUSER.CRANE_STATUS_HIS T2
        WHERE T2.CRNO = #{crno}
          AND (T2.TM BETWEEN TO_TIMESTAMP(#{startTime}, 'yyyy-MM-dd HH24:mi:ss') AND TO_TIMESTAMP(#{endTime}, 'yyyy-MM-dd HH24:mi:ss'))
          AND T2.LOC = (SELECT T1.LOC
                        FROM WLUSER.CRANE_STATUS_HIS T1
                        WHERE T1.TM BETWEEN TO_TIMESTAMP(#{startTime}, 'yyyy-MM-dd HH24:mi:ss') AND TO_TIMESTAMP(#{endTime}, 'yyyy-MM-dd HH24:mi:ss')
                          AND T1.CRNO = #{crno}
                        <if test="arrive != null">
                            ORDER BY T1.TM DESC
                        </if>
                        <if test="leave != null">
                            ORDER BY T1.TM ASC
                        </if>
                        FETCH FIRST 1 ROWS ONLY)
        ORDER BY T2.TM ASC
    </select>
</mapper>